/* SPDX-License-Identifier: BSD-2-Clause */
/*
 * Copyright (c) 2021, Linaro Limited
 *
 */

#ifndef __TPM2_CMDS_H__
#define __TPM2_CMDS_H__

#include <tpm2.h>

enum tpm2_cmd {
	TPM2_CMD_HIER_CONTROL = 0x0121,
	TPM2_CMD_CLEAR = 0x0126,
	TPM2_CMD_CLEARCONTROL = 0x0127,
	TPM2_CMD_HIERCHANGEAUTH = 0x0129,
	TPM2_CMD_NV_DEFINE_SPACE = 0x012a,
	TPM2_CMD_PCR_SETAUTHPOL = 0x012C,
	TPM2_CMD_NV_WRITE = 0x0137,
	TPM2_CMD_NV_WRITELOCK = 0x0138,
	TPM2_CMD_DAM_RESET = 0x0139,
	TPM2_CMD_DAM_PARAMETERS = 0x013A,
	TPM2_CMD_SELF_TEST = 0x0143,
	TPM2_CMD_STARTUP = 0x0144,
	TPM2_CMD_NV_READ = 0x014E,
	TPM2_CMD_GET_CAPABILITY = 0x017A,
	TPM2_CMD_GET_RANDOM = 0x017B,
	TPM2_CMD_PCR_READ = 0x017E,
	TPM2_CMD_PCR_EXTEND = 0x0182,
	TPM2_CMD_PCR_SETAUTHVAL = 0x0183,
};

enum tpm2_sessions {
	TPM2_ST_NO_SESSIONS = 0x8001,
	TPM2_ST_SESSIONS = 0x8002,
};

enum tpm2_startup_state {
	TPM2_SU_CLEAR,
	TPM2_SU_STATE,
};

#define TPM2_SPLIT2CHARS(b16) ((b16) >> 8), ((b16) & 0xFF)
#define TPM2_CMD_RSP_BUF_MAX 256
#define TPM2_CMD_LEN_STARTUP 12
#define TPM2_CMD_LEN_SELFTEST 11

#define TPM2_CMD_PREFIX_STARTUP \
	TPM2_SPLIT2CHARS(TPM2_ST_NO_SESSIONS), \
	0, 0, 0, TPM2_CMD_LEN_STARTUP, \
	0, 0, TPM2_SPLIT2CHARS(TPM2_CMD_STARTUP)

#define TPM2_CMD_PREFIX_SELF_TEST \
	TPM2_SPLIT2CHARS(TPM2_ST_NO_SESSIONS), \
	0, 0, 0, TPM2_CMD_LEN_SELFTEST, \
	0, 0, TPM2_SPLIT2CHARS(TPM2_CMD_SELF_TEST)

enum tpm2_result tpm2_startup(struct tpm2_chip *chip,
			      enum tpm2_startup_state state);

#endif	/* __TPM2_CMDS_H__ */

